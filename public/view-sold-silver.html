<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Sold Silver Stock -Sri Vasavi Jewellers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="view-sold-gold.css">
    <link rel="icon" href="logo.png" type="image/x-icon">


</head>
<body>
    <header>
        <h1>Sold Silver Stock</h1>
        <a href="silver-stock.html" class="back-button">Back</a>
    </header>
    <main>
        <div class="entry-toggle">
            <span>Single Item</span>
            <label class="switch">
                <input type="checkbox" id="massViewSwitch" onchange="toggleView()">
                <span class="slider"></span>
            </label>
            <span>Mass Items</span>
        </div>

        <h1 class="gold-stock-heading">Sold Silver Stock</h1>
        <i class="fa fa-print print-icon" onclick="window.print();"></i>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Silver Type</th>
                    <th>Weight(gm)</th>
                    <th>Date Sold</th>
                    <th>Customer Name</th>
                </tr>
            </thead>
            <tbody id="soldSilverStockTableBody">
                <!-- Table rows will be inserted here by JavaScript -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2"></td>
                    <td id="totalWeight">Total: 0 gm</td>
                    <td colspan="2"></td>
                </tr>
            </tfoot>
        </table>
        <div id="totalItems" class="total-items">Total Items Sold: 0</div>

        <h1 class="gold-stock-heading">Sold Silver Masss Stock</h1>
        <i class="fa fa-print print-icon" onclick="window.print();"></i>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Silver Type</th>
                    <th>Weight(gm)</th>
                    <th>Date Sold</th>
                    <th>Customer Name</th>
                </tr>
            </thead>
            <tbody id="soldMassSilverStockTableBody">
                <!-- Table rows will be inserted here by JavaScript -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2"></td>
                    <td id="totalMassWeight">Total: 0 gm</td>
                    <td colspan="2"></td>
                </tr>
            </tfoot>
        </table>
        <div id="totalMassItems" class="total-items">Total Items Sold: 0</div>

        <div  class="success-message" >Data Fetched successfully!</div>


    </main>
    <script>
        function toggleView() {
            const isChecked = document.getElementById('massViewSwitch').checked;

            // Toggle the display of Sold Gold Stock and Sold Gold Mass Items
            document.querySelector('.gold-stock-heading').style.display = isChecked ? 'none' : 'block';
            document.getElementById('soldSilverStockTableBody').parentElement.style.display = isChecked ? 'none' : 'table';
            document.getElementById('totalItems').style.display = isChecked ? 'none' : 'block';

            document.querySelectorAll('h1.gold-stock-heading')[1].style.display = isChecked ? 'block' : 'none';
            document.querySelectorAll('table')[1].style.display = isChecked ? 'table' : 'none';
            document.getElementById('totalMassItems').style.display = isChecked ? 'block' : 'none';
        }

            // Optionally, initialize view on page load based on the switch state
            window.onload = () => {
                toggleView();
            };
        async function loadSoldSilverStock() {
            try {
                const response = await fetch('/view-sold-silver-stock');
                const data = await response.json();
                
                const tableBody = document.getElementById('soldSilverStockTableBody');
                const totalWeightElement = document.getElementById('totalWeight');
                const totalItemsElement = document.getElementById('totalItems');
                tableBody.innerHTML = '';

                let totalWeight = 0; // Initialize total weight
                let totalItems=0;

                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.silver_type}</td>
                        <td>${parseFloat(item.quantity).toFixed(3)}</td>
                        <td>${formatDate(item.date_sold)}</td>
                        <td>${item.customer_name}</td>
                    `;
                    tableBody.appendChild(row);

                    // Accumulate the total weight
                    totalWeight += item.quantity;
                    totalItems++;
                });

                // Display the total weight
                totalWeightElement.textContent = `Total: ${totalWeight.toFixed(2)} gm`;
                totalItemsElement.textContent = `Total Items Sold: ${totalItems}`;

                const massresponse = await fetch('/view-sold-silver-stock-mass');
                const massdata = await massresponse.json();
                
                const masstableBody = document.getElementById('soldMassSilverStockTableBody');
                const masstotalWeightElement = document.getElementById('totalMassWeight');
                const masstotalItemsElement = document.getElementById('totalMassItems');
                masstableBody.innerHTML = '';

                let masstotalWeight = 0; // Initialize total weight
                let masstotalItems=0;

                massdata.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.silver_type}</td>
                        <td>${parseFloat(item.quantity).toFixed(3)}</td>
                        <td>${formatDate(item.date_sold)}</td>
                        <td>${item.customer_name}</td>
                    `;
                    masstableBody.appendChild(row);

                    // Accumulate the total weight
                    masstotalWeight += item.quantity;
                    masstotalItems++;
                });

                // Display the total weight
                masstotalWeightElement.textContent = `Total: ${masstotalWeight.toFixed(2)} gm`;
                masstotalItemsElement.textContent = `Total Items Sold: ${masstotalItems}`;

            const successMessage = document.querySelector('.success-message');
            successMessage.style.display = 'block'; // Show success message
            successMessage.textContent = 'Data Loaded successfully!';
            }

                 catch (error) {
                console.error('Error loading sold silver stock:', error);
                 
            // Show failure message
            const successMessage = document.querySelector('.success-message');
            successMessage.style.display = 'block'; // Show failure message
            successMessage.textContent = 'Failed to load the stock!';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }

        loadSoldSilverStock();
    </script>
</body>
</html>
