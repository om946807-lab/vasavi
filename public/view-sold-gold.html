<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Sold Gold Stock - Sri Vasavi Jewellers</title>
  <link rel="icon" href="logo.png" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body class="bg-gradient-to-br from-yellow-50 to-white min-h-screen text-gray-800 font-sans">
  <!-- Header -->
  <header class="flex flex-col sm:flex-row justify-between items-center px-4 sm:px-8 py-4 bg-white shadow-md sticky top-0 z-50">
    <h1 class="text-xl sm:text-2xl font-bold text-yellow-700 mb-3 sm:mb-0 text-center sm:text-left">
      Sold Gold Stock
    </h1>
    <a href="gold-stock.html"
       class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition flex items-center">
      <i class="fa fa-arrow-left mr-2"></i>Back
    </a>
  </header>

  <main class="p-4 sm:p-8 space-y-8 max-w-6xl mx-auto">
    
    <!-- Toggle Section -->
    <div class="flex items-center justify-center gap-3 sm:gap-6 flex-wrap">
      <span class="font-medium text-gray-700">Single Item</span>
      <label class="relative inline-flex items-center cursor-pointer">
        <input type="checkbox" id="massViewSwitch" onchange="toggleView()" class="sr-only peer">
        <div class="w-14 h-7 bg-gray-200 rounded-full peer peer-checked:bg-yellow-600 transition-all relative">
          <div class="absolute top-0.5 left-[2px] w-6 h-6 bg-white rounded-full transition-all peer-checked:translate-x-7 shadow"></div>
        </div>
      </label>
      <span class="font-medium text-gray-700">Mass Items</span>
    </div>

    <!-- Success Message -->
    <div id="successMessage"
         class="hidden text-center bg-green-100 text-green-700 px-4 py-2 rounded-md shadow-md max-w-md mx-auto transition-all duration-500">
      Data Loaded Successfully!
    </div>

    <!-- Single Items Section -->
    <section id="singleItemsSection" class="space-y-4">
      <div class="flex flex-col sm:flex-row justify-between items-center gap-3">
        <h2 class="text-lg sm:text-xl font-semibold text-yellow-800">Sold Gold Stock</h2>
        <button onclick="window.print()"
                class="flex items-center gap-2 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition">
          <i class="fa fa-print"></i> Print
        </button>
      </div>

      <div class="overflow-x-auto shadow rounded-lg bg-white">
        <table class="min-w-full text-sm sm:text-base">
          <thead class="bg-yellow-100 text-yellow-800">
            <tr>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">ID</th>
              <th class="py-3 px-2 sm:px-4 text-center font-semibold">Gold Type</th>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">Weight (gm)</th>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">Date Sold</th>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">Customer Name</th>
            </tr>
          </thead>
          <tbody id="soldGoldStockTableBody" class="divide-y divide-gray-200 text-center"></tbody>
          <tfoot class="bg-yellow-50">
            <tr>
              <td colspan="2"></td>
              <td id="totalWeight" class="font-semibold text-yellow-800 py-2">Total: 0.00 gm</td>
              <td colspan="2"></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div id="totalItems" class="text-center font-medium text-gray-700">Total Items Sold: 0</div>
    </section>

    <!-- Mass Items Section -->
    <section id="massItemsSection" class="hidden space-y-4">
      <h2 class="text-lg sm:text-xl font-semibold text-yellow-800">Sold Gold Mass Items</h2>
      <div class="overflow-x-auto shadow rounded-lg bg-white">
        <table class="min-w-full text-sm sm:text-base">
          <thead class="bg-yellow-100 text-yellow-800">
            <tr>
              <th class="py-3 px-2 sm:px-4 text-center font-semibold">ID</th>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">Gold Type</th>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">Weight (gm)</th>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">Date Sold</th>
              <th class="py-3 px-2 sm:px-4 text-left font-semibold">Customer Name</th>
            </tr>
          </thead>
          <tbody id="soldGoldMassStockTableBody" class="divide-y divide-gray-200 text-center"></tbody>
          <tfoot class="bg-yellow-50">
            <tr>
              <td colspan="2"></td>
              <td id="totalMassWeight" class="font-semibold text-yellow-800 py-2">Total: 0.00 gm</td>
              <td colspan="2"></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div id="totalMassItems" class="text-center font-medium text-gray-700">Total Mass Items Sold: 0</div>
    </section>

  </main>

  <script>
    async function loadSoldGoldStocks() {
      try {
        const goldResponse = await fetch('/view-sold-gold-stock');
        const goldData = await goldResponse.json();
        const massResponse = await fetch('/view-sold-gold-stock-mass');
        const massData = await massResponse.json();
        

        const goldBody = document.getElementById('soldGoldStockTableBody');
        const massBody = document.getElementById('soldGoldMassStockTableBody');
        goldBody.innerHTML = '';
        massBody.innerHTML = '';

        let totalGold = 0, totalMass = 0;
        let countGold = 0, countMass = 0;

        goldData.forEach(item => {
          goldBody.innerHTML += `
            <tr>
              <td class="py-2 px-2 sm:px-4">${item.id}</td>
              <td class="py-2 px-2 sm:px-4">${item.gold_type}</td>
              <td class="py-2 px-2 sm:px-4">${parseFloat(item.quantity).toFixed(3)}</td>
              <td class="py-2 px-2 sm:px-4">${formatDate(item.date_sold)}</td>
              <td class="py-2 px-2 sm:px-4">${item.customer_name}</td>
            </tr>`;
          totalGold += parseFloat(item.quantity);
          countGold++;
        });

        massData.forEach(item => {
          massBody.innerHTML += `
            <tr>
              <td class="py-2 px-2 sm:px-4">${item.id}</td>
              <td class="py-2 px-2 sm:px-4">${item.gold_type}</td>
              <td class="py-2 px-2 sm:px-4">${parseFloat(item.quantity).toFixed(3)}</td>
              <td class="py-2 px-2 sm:px-4">${formatDate(item.date_sold)}</td>
              <td class="py-2 px-2 sm:px-4">${item.customer_name}</td>
            </tr>`;
          totalMass += parseFloat(item.quantity);
          countMass++;
        });

        document.getElementById('totalWeight').textContent = `Total: ${totalGold.toFixed(2)} gm`;
        document.getElementById('totalItems').textContent = `Total Items Sold: ${countGold}`;
        document.getElementById('totalMassWeight').textContent = `Total: ${totalMass.toFixed(2)} gm`;
        document.getElementById('totalMassItems').textContent = `Total Mass Items Sold: ${countMass}`;

        showMessage('Data Loaded Successfully!');
      } catch (error) {
        console.error('Error loading data:', error);
        showMessage('Failed to load stock data!');
      }
    }

    function formatDate(dateString) {
      const d = new Date(dateString);
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = d.getFullYear();
      return `${day}-${month}-${year}`;
    }

    function toggleView() {
      const isMass = document.getElementById('massViewSwitch').checked;
      document.getElementById('singleItemsSection').classList.toggle('hidden', isMass);
      document.getElementById('massItemsSection').classList.toggle('hidden', !isMass);
    }

    function showMessage(text) {
      const msg = document.getElementById('successMessage');
      msg.textContent = text;
      msg.classList.remove('hidden', 'opacity-0');
      setTimeout(() => msg.classList.add('opacity-0'), 2000);
      setTimeout(() => msg.classList.add('hidden'), 2500);
    }

    document.addEventListener('DOMContentLoaded', loadSoldGoldStocks);
  </script>
</body>
</html>
