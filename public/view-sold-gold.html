<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Sold Gold Stock-Sri Vasavi Jewellers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="view-sold-gold.css">
    <link rel="icon" href="logo.png" type="image/x-icon">

</head>
<body>
    <header>
        <h1>Sold Gold Stock</h1>
        <a href="gold-stock.html" class="back-button">Back</a>
    </header>
    <main>
        <div class="entry-toggle">
            <span>Single Item</span>
            <label class="switch">
                <input type="checkbox" id="massViewSwitch" onchange="toggleView()">
                <span class="slider"></span>
            </label>
            <span>Mass Items</span>
        </div>
        
        <h1 class="gold-stock-heading">Sold Gold Stock</h1>
        <i class="fa fa-print print-icon" onclick="window.print();"></i>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Gold Type</th>
                    <th>Weight(gm)</th>
                    <th>Date Sold</th>
                    <th>Customer Name</th>
                </tr>
            </thead>
            <tbody id="soldGoldStockTableBody">
                <!-- Table rows for Single Items will be inserted here by JavaScript -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2"></td>
                    <td id="totalWeight">Total: 0.00 gm</td>
                    <td colspan="2"></td>
                </tr>
            </tfoot>
        </table>
        <div id="totalItems" class="total-items">Total Items Sold: 0</div>
        
        <!-- Replicated Section for Mass Items -->
        <h1 class="gold-stock-heading">Sold Gold Mass Items</h1>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Gold Type</th>
                    <th>Weight(gm)</th>
                    <th>Date Sold</th>
                    <th>Customer Name</th>
                </tr>
            </thead>
            <tbody id="soldGoldMassStockTableBody">
                <!-- Table rows for Mass Items will be inserted here by JavaScript -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2"></td>
                    <td id="totalMassWeight">Total: 0.00 gm</td>
                    <td colspan="2"></td>
                </tr>
            </tfoot>
        </table>
        <div id="totalMassItems" class="total-items">Total Mass Items Sold: 0</div>
        
        <div  class="success-message" >Data Fetched successfully!</div>

    </main>
    <script>
     async function loadSoldGoldStocks() {
        try {
            // Fetch data for sold gold stock
            const goldResponse = await fetch('/view-sold-gold-stock');
            const goldData = await goldResponse.json();

            // Fetch data for sold gold mass stock
            const massResponse = await fetch('/view-sold-gold-stock-mass');
            const massData = await massResponse.json();

            // Update sold gold stock table
            const goldTableBody = document.getElementById('soldGoldStockTableBody');
            const totalWeightElementGold = document.getElementById('totalWeight');
            const totalItemsElementGold = document.getElementById('totalItems');
            goldTableBody.innerHTML = '';

            let totalWeightGold = 0; // Initialize total weight for gold
            let totalItemsGold = 0; // Initialize total items for gold

            goldData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.gold_type}</td>
                    <td>${parseFloat(item.quantity).toFixed(3)}</td>
                    <td>${formatDate(item.date_sold)}</td>
                    <td>${item.customer_name}</td>
                `;
                goldTableBody.appendChild(row);
                
                totalWeightGold += parseFloat(item.quantity); // Accumulate total weight for gold
                totalItemsGold++; // Increment total items for gold
            });

            totalWeightElementGold.textContent = `Total: ${totalWeightGold.toFixed(2)} gm`;
            totalItemsElementGold.textContent = `Total Items Sold: ${totalItemsGold}`;

            // Update sold gold mass stock table
            const massTableBody = document.getElementById('soldGoldMassStockTableBody');
            const totalWeightElementMass = document.getElementById('totalMassWeight');
            const totalItemsElementMass = document.getElementById('totalMassItems');
            massTableBody.innerHTML = '';

            let totalWeightMass = 0; // Initialize total weight for mass
            let totalItemsMass = 0; // Initialize total items for mass

            massData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.gold_type}</td>
                    <td>${parseFloat(item.quantity).toFixed(3)}</td>
                    <td>${formatDate(item.date_sold)}</td>
                    <td>${item.customer_name}</td>
                `;
                massTableBody.appendChild(row);
                
                totalWeightMass += parseFloat(item.quantity); // Accumulate total weight for mass
                totalItemsMass++; // Increment total items for mass
            });

            totalWeightElementMass.textContent = `Total: ${totalWeightMass.toFixed(2)} gm`;
            totalItemsElementMass.textContent = `Total Mass Items Sold: ${totalItemsMass}`;

            // Show success message
            const successMessage = document.querySelector('.success-message');
            successMessage.style.display = 'block'; // Show success message
            successMessage.textContent = 'Data Loaded successfully!';

        } catch (error) {
            console.error('Error loading sold gold stocks:', error);
            
            // Show failure message
            const successMessage = document.querySelector('.success-message');
            successMessage.style.display = 'block'; // Show failure message
            successMessage.textContent = 'Failed to load the stock!';

          
        }
    }

        document.addEventListener('DOMContentLoaded', loadSoldGoldStocks);



        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }
        
        function toggleView() {
            const isChecked = document.getElementById('massViewSwitch').checked;

            // Toggle the display of Sold Gold Stock and Sold Gold Mass Items
            document.querySelector('.gold-stock-heading').style.display = isChecked ? 'none' : 'block';
            document.getElementById('soldGoldStockTableBody').parentElement.style.display = isChecked ? 'none' : 'table';
            document.getElementById('totalItems').style.display = isChecked ? 'none' : 'block';

            document.querySelectorAll('h1.gold-stock-heading')[1].style.display = isChecked ? 'block' : 'none';
            document.querySelectorAll('table')[1].style.display = isChecked ? 'table' : 'none';
            document.getElementById('totalMassItems').style.display = isChecked ? 'block' : 'none';
        }

            // Optionally, initialize view on page load based on the switch state
            window.onload = () => {
                toggleView();
            };

    </script>
</body>
</html>
